@inject CartService CartService
@inject NavigationManager Navigation
@implements IDisposable

<a class="nav-link cart-icon-wrapper" href="/cart" @onclick="NavigateToCart" @onclick:preventDefault>
    <i class="bi bi-cart3 cart-icon__icon"></i>
    <span class="cart-icon__label">Количка</span>
    @if (_itemCount > 0)
    {
        <span class="cart-icon__badge badge-nsi-accent">@_itemCount</span>
    }
</a>

@code {
    private int _itemCount;

    protected override void OnInitialized()
    {
        _itemCount = CartService.GetItemCount();
        CartService.OnCartChanged += OnCartChanged;
    }

    private void OnCartChanged()
    {
        _itemCount = CartService.GetItemCount();
        InvokeAsync(StateHasChanged);
    }

    private void NavigateToCart()
    {
        Navigation.NavigateTo("/cart");
    }

    public void Dispose()
    {
        CartService.OnCartChanged -= OnCartChanged;
    }
}
