@inject CartService CartService
@inject NavigationManager Navigation
@implements IDisposable

<a class="nav-link" href="/cart" @onclick="NavigateToCart" @onclick:preventDefault>
    <i class="bi bi-cart3"></i> Количка
    @if (_itemCount > 0)
    {
        <span class="badge bg-danger rounded-pill ms-1">@_itemCount</span>
    }
</a>

@code {
    private int _itemCount;

    protected override void OnInitialized()
    {
        _itemCount = CartService.GetItemCount();
        CartService.OnCartChanged += OnCartChanged;
    }

    private void OnCartChanged()
    {
        _itemCount = CartService.GetItemCount();
        InvokeAsync(StateHasChanged);
    }

    private void NavigateToCart()
    {
        Navigation.NavigateTo("/cart");
    }

    public void Dispose()
    {
        CartService.OnCartChanged -= OnCartChanged;
    }
}
