@using NaturalStoneImpex.Client.Models
@inject CartService CartService

<div class="card h-100">
    @if (!string.IsNullOrEmpty(Product.ImagePath))
    {
        <a href="/products/@Product.Id">
            <img src="@Product.ImagePath" class="card-img-top" alt="@Product.Name" style="height: 200px; object-fit: cover;" />
        </a>
    }
    else
    {
        <a href="/products/@Product.Id" class="text-decoration-none">
            <div class="bg-light d-flex align-items-center justify-content-center text-muted" style="height: 200px;">
                Няма снимка
            </div>
        </a>
    }

    <div class="card-body d-flex flex-column">
        <h6 class="card-title">
            <a href="/products/@Product.Id" class="text-decoration-none text-dark">@Product.Name</a>
        </h6>

        <div class="mb-2">
            <span class="fw-bold fs-5">@Product.PriceWithVat.ToString("F2") €</span>
            <br />
            <small class="text-muted">вкл. @Product.VatAmount.ToString("F2") € ДДС</small>
        </div>

        <div class="mb-3">
            <span class="badge bg-secondary">@Product.UnitDisplay</span>
        </div>

        <div class="mt-auto">
            @if (Product.StockQuantity > 0)
            {
                <button class="btn btn-primary w-100" @onclick="OnAddToCart">
                    Добави в количката
                </button>
            }
            else
            {
                <span class="badge bg-danger w-100 py-2 fs-6">Изчерпан</span>
            }
        </div>
    </div>
</div>

<ToastNotification @ref="_toast" />

@code {
    [Parameter, EditorRequired]
    public ProductListDto Product { get; set; } = default!;

    private ToastNotification _toast = default!;

    private void OnAddToCart()
    {
        CartService.AddItem(new CartItem
        {
            ProductId = Product.Id,
            ProductName = Product.Name,
            UnitPriceWithVat = Product.PriceWithVat,
            VatAmount = Product.VatAmount,
            UnitPriceWithoutVat = Product.PriceWithoutVat,
            Unit = Product.Unit,
            UnitDisplay = Product.UnitDisplay,
            Quantity = 1,
            ImagePath = Product.ImagePath
        });
        _toast.Show("Продуктът е добавен в количката.");
    }
}
