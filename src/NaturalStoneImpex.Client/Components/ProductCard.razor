@using NaturalStoneImpex.Client.Models
@inject CartService CartService

<div class="product-card card border-0 shadow-sm h-100 @(Product.StockQuantity <= 0 ? "product-card--out-of-stock" : "")">
    @if (!string.IsNullOrEmpty(Product.ImagePath))
    {
        <a href="/products/@Product.Id" class="img-zoom-wrapper product-card__img-wrapper">
            <img src="@Product.ImagePath" class="card-img-top" alt="@Product.Name" />
        </a>
    }
    else
    {
        <a href="/products/@Product.Id" class="text-decoration-none">
            <div class="product-card__placeholder d-flex flex-column align-items-center justify-content-center">
                <i class="bi bi-image product-card__placeholder-icon"></i>
                <span class="product-card__placeholder-text">Няма снимка</span>
            </div>
        </a>
    }

    <div class="card-body d-flex flex-column p-3">
        <h6 class="card-title mb-2">
            <a href="/products/@Product.Id" class="product-card__name">@Product.Name</a>
        </h6>

        <div class="product-card__pricing mb-2">
            <span class="product-card__price">@Product.PriceWithVat.ToString("F2") €</span>
            <br />
            <small class="product-card__vat">вкл. @Product.VatAmount.ToString("F2") € ДДС</small>
        </div>

        <div class="mb-3">
            <span class="badge badge-nsi-accent rounded-pill">@Product.UnitDisplay</span>
        </div>

        <div class="mt-auto">
            @if (Product.StockQuantity > 0)
            {
                <button class="btn btn-nsi-accent w-100 product-card__cart-btn" @onclick="OnAddToCart">
                    <i class="bi bi-cart-plus me-1"></i> Добави в количката
                </button>
            }
            else
            {
                <span class="badge product-card__out-badge rounded-pill w-100 py-2">Изчерпан</span>
            }
        </div>
    </div>
</div>

<ToastNotification @ref="_toast" />

@code {
    [Parameter, EditorRequired]
    public ProductListDto Product { get; set; } = default!;

    private ToastNotification _toast = default!;

    private void OnAddToCart()
    {
        CartService.AddItem(new CartItem
        {
            ProductId = Product.Id,
            ProductName = Product.Name,
            UnitPriceWithVat = Product.PriceWithVat,
            VatAmount = Product.VatAmount,
            UnitPriceWithoutVat = Product.PriceWithoutVat,
            Unit = Product.Unit,
            UnitDisplay = Product.UnitDisplay,
            Quantity = 1,
            ImagePath = Product.ImagePath
        });
        _toast.Show("Продуктът е добавен в количката.");
    }
}
